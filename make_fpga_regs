# This is the name of the block design we're going to scan
filename=project.srcs/sources_1/bd/top_level/top_level.bd

# This is the fabric bridge connection we're looking for
connection="design.addressing./CIPS.address_spaces.M_AXI_FPD.segments."

# We are going to temporarily create this AXI address map
addr_map=addr_map.tmp

# If we're just showing the address map, make it so
if [ "$1" == "-map" ]; then
    
    # Find out where we're going to wrie the output
    test -z $2 && output=/dev/stdout || output=$2

    # Create a list of every AXI Slave connected to PCIe bridge
    parse_xbd $filename | grep $connection >$addr_map

    # Display the connection names and their addresses
    xlate_vreg -names $addr_map >$output

    # Throw away the temporary file
    rm $addr_map

    # We're just showing the address map, so we're done
    exit 0
fi

# We only support the "-map" option for now
exit 0
    
# Create a list of every AXI Slave connected to PCIe bridge
parse_xbd $filename | grep $connection >$addr_map

# Create the "fpga_regs.h" output file 
xlate_vreg $addr_map fpga_regs.h 

# Throw away the temporary file
rm $addr_map


